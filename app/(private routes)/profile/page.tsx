// // import { redirect } from "next/navigation";
// import Image from "next/image";
// import Link from "next/link";
// import { getUserServer } from "../../../lib/api/serverApi";
// import type { Metadata } from "next";
// import type { User } from "../../../types/user";

// export const metadata: Metadata = {
//   title: "Profile",
//   description: "–ü–µ—Ä–µ–≥–ª—è–¥ –ø—Ä–æ—Ñ—ñ–ª—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ NoteHub",
// };

// export default async function ProfilePage() {
//   const user: User | null = await getUserServer();
//   console.log("user in ProfilePage:", user);

//   if (!user) {
//     return <p>Loading...</p>;
//   }

//   return (
//     <div className="max-w-xl mx-auto mt-10 text-center">
//       <Image
//         src={user.avatar || "/default-avatar.png"}
//         alt="Avatar"
//         width={128}
//         height={128}
//         className="rounded-full mx-auto"
//       />
//       <h1 className="text-2xl font-bold mt-4">{user.username}</h1>
//       <p className="text-gray-600">{user.email}</p>
//       <Link
//         href="/profile/edit"
//         className="mt-4 inline-block text-blue-600 hover:underline"
//       >
//         Edit Profile
//       </Link>
//     </div>
//   );
// }

// app/(private routes)/profile/page.tsx
import Image from "next/image";
import Link from "next/link";
import { getUserServer } from "../../../lib/api/serverApi";
import { cookies } from "next/headers";
import type { Metadata } from "next";
import type { User } from "../../../types/user";
import css from "./ProfilePage.module.css"; // üëà —ñ–º–ø–æ—Ä—Ç —Å—Ç–∏–ª—ñ–≤

export const metadata: Metadata = {
  title: "Profile",
  description: "–ü–µ—Ä–µ–≥–ª—è–¥ –ø—Ä–æ—Ñ—ñ–ª—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ NoteHub",
};

export default async function ProfilePage() {
  // --- 1. –û—Ç—Ä–∏–º—É—î–º–æ cookies —á–µ—Ä–µ–∑ Next.js ---
  const cookieStore = await cookies();
  const accessToken = cookieStore.get("accessToken")?.value ?? null;
  const refreshToken = cookieStore.get("refreshToken")?.value ?? null;

  // --- 2. –§–æ—Ä–º—É—î–º–æ Cookie header ---
  const cookieHeader = [
    accessToken ? `accessToken=${accessToken}` : "",
    refreshToken ? `refreshToken=${refreshToken}` : "",
  ]
    .filter(Boolean)
    .join("; ");

  // --- 3. –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Å–µ—Ä–≤–µ—Ä—É ---
  const user: User | null = await getUserServer(cookieHeader);
  console.log("user in ProfilePage:", user);

  if (!user) {
    return <p>Loading...</p>;
  }

  return (
    <main className={css.mainContent}>
      <section className={css.profileCard}>
        <div className={css.header}>
          <h1 className={css.formTitle}>Profile</h1>
          <Link href="/profile/edit" className={css.editProfileButton}>
            Edit Profile
          </Link>
        </div>

        <div className={css.avatarWrapper}>
          <Image
            src={user.avatar || "/default-avatar.png"}
            alt="Avatar"
            width={128}
            height={128}
            className={css.avatar}
          />
        </div>

        <div className={css.profileInfo}>
          <div className={css.usernameWrapper}>
            <span>{user.username}</span>
          </div>
          <p>{user.email}</p>
        </div>
      </section>
    </main>
  );
}

// app/(private routes)/profile/page.tsx
// import Image from "next/image";
// import Link from "next/link";
// import { getUserServer } from "../../../lib/api/serverApi";
// import { cookies } from "next/headers"; // –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è cookies
// import type { Metadata } from "next";
// import type { User } from "../../../types/user";

// export const metadata: Metadata = {
//   title: "Profile",
//   description: "–ü–µ—Ä–µ–≥–ª—è–¥ –ø—Ä–æ—Ñ—ñ–ª—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ NoteHub",
// };

// export default async function ProfilePage() {
//   // --- 1. –û—Ç—Ä–∏–º—É—î–º–æ cookies —á–µ—Ä–µ–∑ Next.js ---
//   const cookieStore = await cookies(); // üëà –¥–æ–¥–∞–Ω–æ await
//   const accessToken = cookieStore.get("accessToken")?.value ?? null;
//   const refreshToken = cookieStore.get("refreshToken")?.value ?? null;

//   // --- 2. –§–æ—Ä–º—É—î–º–æ Cookie header ---
//   const cookieHeader = [
//     accessToken ? `accessToken=${accessToken}` : "",
//     refreshToken ? `refreshToken=${refreshToken}` : "",
//   ]
//     .filter(Boolean)
//     .join("; ");

//   // --- 3. –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Å–µ—Ä–≤–µ—Ä—É ---
//   const user: User | null = await getUserServer(cookieHeader);
//   console.log("user in ProfilePage:", user);

//   if (!user) {
//     return <p>Loading...</p>;
//   }

//   return (
//     <div className="max-w-xl mx-auto mt-10 text-center">
//       <Image
//         src={user.avatar || "/default-avatar.png"}
//         alt="Avatar"
//         width={128}
//         height={128}
//         className="rounded-full mx-auto"
//       />
//       <h1 className="text-2xl font-bold mt-4">{user.username}</h1>
//       <p className="text-gray-600">{user.email}</p>
//       <Link
//         href="/profile/edit"
//         className="mt-4 inline-block text-blue-600 hover:underline"
//       >
//         Edit Profile
//       </Link>
//     </div>
//   );
// }
